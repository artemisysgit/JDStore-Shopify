{{ 'component-cart.css' | asset_url | stylesheet_tag }}
{{ 'component-cart-items.css' | asset_url | stylesheet_tag }}
{{ 'component-totals.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-discounts.css' | asset_url | stylesheet_tag }}
{{ 'quantity-popover.css' | asset_url | stylesheet_tag }}

{%- style -%}
      .section-{{ section.id }}-padding {
        padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
        padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
      }

      @media screen and (min-width: 750px) {
        .section-{{ section.id }}-padding {
          padding-top: {{ section.settings.padding_top }}px;
          padding-bottom: {{ section.settings.padding_bottom }}px;
        }
      }


        dl {
            display: flex;
            flex-wrap: wrap;
        }
        dt {
            width: auto; /* Adjust the width as needed */
            padding-left: 20px; /* Adjust the padding as needed */
            font-weight: bold;
        }
        dd {
            width: calc(100% - 120px); /* Adjust the width to match the dt width + padding */
            padding-left: 10px; /* Adjust the padding as needed */
            margin-left: 0; /* Reset default margin */
        }

        .cart-sidebar-discount {
        display: flex;
        flex-direction: column;
        width:300px;
        margin: 20px auto;
      }
      .cart-sidebar-discount input {
        margin-top:20px;
        background: #eee;
        border: 1px solid #eee;
        height:50px;
        outline: none;
        font-size: 18px;
        letter-spacing: .75px;
        text-align: center;
      }
      #apply-discount-btn {
        background-color: #000;
        color:#fff;
        border: 0;
        height: 45px;
        width: 40%;
        font-size: 18px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: .75px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
      }
      span.applied-discount-code-value>small {
        background: #eee;
        padding: 0px 10px;
        color: #000;
        font-weight: bold;
        border-radius: 20px;
      }
      .loader {
        border: 5px solid #f3f3f3;
        border-top: 4px solid #000;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        animation: spin .5s linear infinite;
      }
      #discount-code-error {
        background: #ff00004f;
        color: #e22120;
        padding: 5px;
        border-radius: 4px;
        font-size: 13px;
        line-height: 1;
      }
      .applied-discount-code-wrapper {
        display: none;
        background: #ddd;
        padding: 3px 10px;
        margin-bottom: 15px;
        border-radius: 25px;
      }
      .applied-discount-code-value {
        font-size: 13px;
        text-transform: uppercase;
      }

      #discount-code-error:empty {
        display: none;
      }
      .applied-discount-code-value:empty+button {
        display: none;
      }
      button#clear-discount-btn {
      margin-left: 10px;
  }
    .tag-icon{
      transform: rotateY(180deg);
      margin-right: 5px;
    }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
{%- endstyle -%}

{%- unless settings.cart_type == 'drawer' -%}
  <script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>
{%- endunless -%}

<script src="{{ 'quantity-popover.js' | asset_url }}" defer="defer"></script>

<cart-items
  style="display:none;"
  class="gradient color-{{ section.settings.color_scheme }} isolate{% if cart == empty %} is-empty{% else %} section-{{ section.id }}-padding{% endif %}"
>
  <div class="page-width">
    <div class="title-wrapper-with-link">
      <h1 class="title title--primary">{{ 'sections.cart.title' | t }}</h1>
      <a href="{{ routes.all_products_collection_url }}" class="underlined-link">
        {{- 'general.continue_shopping' | t -}}
      </a>
    </div>

    <div class="cart__warnings">
      <h1 class="cart__empty-text">{{ 'sections.cart.empty' | t }}</h1>
      <a href="{{ routes.all_products_collection_url }}" class="button">
        {{ 'general.continue_shopping' | t }}
      </a>

      {%- if shop.customer_accounts_enabled and customer == null -%}
        <h2 class="cart__login-title">{{ 'sections.cart.login.title' | t }}</h2>
        <p class="cart__login-paragraph">
          {{ 'sections.cart.login.paragraph_html' | t: link: routes.account_login_url }}
        </p>
      {%- endif -%}
    </div>

    <form action="{{ routes.cart_url }}" class="cart__contents critical-hidden" method="post" id="cart">
      <div class="cart__items" id="main-cart-items" data-id="{{ section.id }}">
        <div class="js-contents">
          {%- if cart != empty -%}
            <table class="cart-items">
              <caption class="visually-hidden">
                {{ 'sections.cart.title' | t }}
              </caption>
              <thead>
                <tr>
                  <th class="caption-with-letter-spacing" colspan="2" scope="col">
                    {{ 'sections.cart.headings.product' | t }}
                  </th>
                  <th class="medium-hide large-up-hide right caption-with-letter-spacing" colspan="1" scope="col">
                    {{ 'sections.cart.headings.total' | t }}
                  </th>
                  <th
                    class="cart-items__heading--wide cart-items__heading--quantity small-hide caption-with-letter-spacing"
                    colspan="1"
                    scope="col"
                  >
                    {{ 'sections.cart.headings.quantity' | t }}
                  </th>
                  <th class="small-hide right caption-with-letter-spacing" colspan="1" scope="col">
                    {{ 'sections.cart.headings.total' | t }}
                  </th>
                </tr>
              </thead>

              <tbody>
                {%- for item in cart.items -%}
                  <tr class="cart-item" id="CartItem-{{ item.index | plus: 1 }}">
                    <td class="cart-item__media">
                      {% if item.image %}
                        {% comment %} Leave empty space due to a:empty CSS display: none rule {% endcomment %}
                        <a href="{{ item.url }}" class="cart-item__link" aria-hidden="true" tabindex="-1"> </a>
                        <div class="cart-item__image-container gradient global-media-settings">
                          <img
                            src="{{ item.image | image_url: width: 300 }}"
                            class="cart-item__image"
                            alt="{{ item.image.alt | escape }}"
                            loading="lazy"
                            width="150"
                            height="{{ 150 | divided_by: item.image.aspect_ratio | ceil }}"
                          >
                        </div>
                      {% endif %}
                    </td>

                    <td class="cart-item__details">
                      {%- if settings.show_vendor -%}
                        <p class="caption-with-letter-spacing">{{ item.product.vendor }}</p>
                      {%- endif -%}

                      <a href="{{ item.url }}" class="cart-item__name h4 break">{{ item.product.title | escape }}</a>

                      {%- if item.original_price != item.final_price -%}
                        <div class="cart-item__discounted-prices">
                          <span class="visually-hidden">
                            {{ 'products.product.price.regular_price' | t }}
                          </span>
                          <s class="cart-item__old-price product-option">
                            {{- item.original_price | money -}}
                          </s>
                          <span class="visually-hidden">
                            {{ 'products.product.price.sale_price' | t }}
                          </span>
                          <strong class="cart-item__final-price product-option">
                            {{ item.final_price | money }}
                          </strong>
                        </div>
                      {%- else -%}
                        <div class="product-option">
                          {{ item.original_price | money }}
                        </div>
                      {%- endif -%}

                      {%- if item.product.has_only_default_variant == false
                        or item.properties.size != 0
                        or item.selling_plan_allocation != null
                      -%}
                        <dl>
                          {%- if item.product.has_only_default_variant == false -%}
                            {%- for option in item.options_with_values -%}
                              <div class="product-option">
                                <dt>{{ option.name }}:</dt>
                                <dd>{{ option.value }}</dd>
                              </div>
                            {%- endfor -%}
                          {%- endif -%}

                          {%- for property in item.properties -%}
                            {%- assign property_first_char = property.first | slice: 0 -%}
                            {%- if property.last != blank and property_first_char != '_' -%}
                              <div class="product-option">
                                <dt>{{ property.first }}:</dt>
                                <dd>
                                  {%- if property.last contains '/uploads/' -%}
                                    <a href="{{ property.last }}" class="link" target="_blank">
                                      {{ property.last | split: '/' | last }}
                                    </a>
                                  {%- else -%}
                                    {{ property.last }}
                                  {%- endif -%}
                                </dd>
                              </div>
                            {%- endif -%}
                          {%- endfor -%}
                        </dl>

                        <p class="product-option">{{ item.selling_plan_allocation.selling_plan.name }}</p>
                      {%- endif -%}

                      <ul class="discounts list-unstyled" role="list" aria-label="{{ 'customer.order.discount' | t }}">
                        {%- for discount in item.line_level_discount_allocations -%}
                          <li class="discounts__discount">
                            {%- render 'icon-discount' -%}
                            {{ discount.discount_application.title }}
                          </li>
                        {%- endfor -%}
                      </ul>
                    </td>

                    <td class="cart-item__totals right medium-hide large-up-hide">
                      {%- render 'loading-spinner' -%}
                      <div class="cart-item__price-wrapper">
                        {%- if item.original_line_price != item.final_line_price -%}
                          <dl class="cart-item__discounted-prices">
                            <dt class="visually-hidden">
                              {{ 'products.product.price.regular_price' | t }}
                            </dt>
                            <dd>
                              <s class="cart-item__old-price price price--end">
                                {{ item.original_line_price | money }}
                              </s>
                            </dd>
                            <dt class="visually-hidden">
                              {{ 'products.product.price.sale_price' | t }}
                            </dt>
                            <dd class="price price--end">
                              {{ item.final_line_price | money }}
                            </dd>
                          </dl>
                        {%- else -%}
                          <span class="price price--end">
                            {{ item.original_line_price | money }}
                          </span>
                        {%- endif -%}

                        {%- if item.variant.available and item.unit_price_measurement -%}
                          <div class="unit-price caption">
                            <span class="visually-hidden">{{ 'products.product.price.unit_price' | t }}</span>
                            {{ item.unit_price | money }}
                            <span aria-hidden="true">/</span>
                            <span class="visually-hidden"
                              >&nbsp;{{ 'accessibility.unit_price_separator' | t }}&nbsp;</span
                            >
                            {%- if item.unit_price_measurement.reference_value != 1 -%}
                              {{- item.unit_price_measurement.reference_value -}}
                            {%- endif -%}
                            {{ item.unit_price_measurement.reference_unit }}
                          </div>
                        {%- endif -%}
                      </div>
                    </td>
                    {%- liquid
                      assign has_qty_rules = false
                      if item.variant.quantity_rule.increment > 1 or item.variant.quantity_rule.min > 1 or item.variant.quantity_rule.max != null
                        assign has_qty_rules = true
                      endif

                      assign has_vol_pricing = false
                      if item.variant.quantity_price_breaks.size > 0
                        assign has_vol_pricing = true
                      endif
                    -%}
                    <td class="cart-item__quantity{% if has_qty_rules or has_vol_pricing %} cart-item__quantity--info{% endif %}">
                      <quantity-popover>
                        <div class="cart-item__quantity-wrapper quantity-popover-wrapper">
                          <label class="visually-hidden" for="Quantity-{{ item.index | plus: 1 }}">
                            {{ 'products.product.quantity.label' | t }}
                          </label>
                          <div class="quantity-popover-container{% if has_qty_rules or has_vol_pricing %} quantity-popover-container--hover{% endif %}">
                            {%- if has_qty_rules or has_vol_pricing -%}
                              <button
                                type="button"
                                aria-expanded="false"
                                class="quantity-popover__info-button quantity-popover__info-button--icon-only button button--tertiary small-hide no-js-hidden"
                              >
                                {% render 'icon-info' %}
                              </button>
                            {%- endif -%}
                            <quantity-input class="quantity cart-quantity">
                              <button class="quantity__button no-js-hidden" name="minus" type="button">
                                <span class="visually-hidden">
                                  {{- 'products.product.quantity.decrease' | t: product: item.product.title | escape -}}
                                </span>
                                {% render 'icon-minus' %}
                              </button>
                              <input
                                class="quantity__input"
                                data-quantity-variant-id="{{ item.variant.id }}"
                                type="number"
                                name="updates[]"
                                value="{{ item.quantity }}"
                                {% # theme-check-disable %}
                                data-cart-quantity="{{ cart | item_count_for_variant: item.variant.id }}"
                                min="{{ item.variant.quantity_rule.min }}"
                                {% if item.variant.quantity_rule.max != null %}
                                  max="{{ item.variant.quantity_rule.max }}"
                                {% endif %}
                                step="{{ item.variant.quantity_rule.increment }}"
                                {% # theme-check-enable %}
                                aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                                id="Quantity-{{ item.index | plus: 1 }}"
                                data-index="{{ item.index | plus: 1 }}"
                              >
                              <button class="quantity__button no-js-hidden" name="plus" type="button">
                                <span class="visually-hidden">
                                  {{- 'products.product.quantity.increase' | t: product: item.product.title | escape -}}
                                </span>
                                {% render 'icon-plus' %}
                              </button>
                            </quantity-input>
                          </div>
                          <cart-remove-button
                            id="Remove-{{ item.index | plus: 1 }}"
                            data-index="{{ item.index | plus: 1 }}"
                          >
                            <a
                              href="{{ item.url_to_remove }}"
                              class="button button--tertiary"
                              aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                            >
                              {% render 'icon-remove' %}
                            </a>
                          </cart-remove-button>
                        </div>
                        {%- if has_qty_rules or has_vol_pricing -%}
                          <button
                            type="button"
                            class="quantity-popover__info-button quantity-popover__info-button--icon-with-label button button--tertiary medium-hide large-up-hide"
                            aria-expanded="false"
                          >
                            {% render 'icon-info' %}
                            <span>
                              {%- if has_vol_pricing -%}
                                {{ 'products.product.volume_pricing.note' | t }}
                              {%- elsif has_qty_rules -%}
                                {{ 'products.product.quantity.note' | t }}
                              {%- endif -%}
                            </span>
                          </button>
                        {%- endif -%}
                        {%- if has_vol_pricing or has_qty_rules -%}
                          <div
                            class="cart-items__info global-settings-popup quantity-popover__info"
                            tabindex="-1"
                            hidden
                          >
                            {%- if has_qty_rules == false -%}
                              <span class="volume-pricing-label caption">
                                {{- 'products.product.volume_pricing.title' | t -}}
                              </span>
                            {%- endif -%}
                            <div class="quantity__rules caption no-js-hidden">
                              {%- if item.variant.quantity_rule.increment > 1 -%}
                                <span class="divider">
                                  {{-
                                    'products.product.quantity.multiples_of'
                                    | t: quantity: item.variant.quantity_rule.increment
                                  -}}
                                </span>
                              {%- endif -%}
                              {%- if item.variant.quantity_rule.min > 1 -%}
                                <span class="divider">
                                  {{-
                                    'products.product.quantity.minimum_of'
                                    | t: quantity: item.variant.quantity_rule.min
                                  -}}
                                </span>
                              {%- endif -%}
                              {%- if item.variant.quantity_rule.max != null -%}
                                <span class="divider">
                                  {{-
                                    'products.product.quantity.maximum_of'
                                    | t: quantity: item.variant.quantity_rule.max
                                  -}}
                                </span>
                              {%- endif -%}
                            </div>
                            <button
                              class="button-close button button--tertiary medium-hide large-up-hide"
                              type="button"
                              aria-label="{{ 'accessibility.close' | t }}"
                            >
                              {%- render 'icon-close' -%}
                            </button>
                            {%- if item.variant.quantity_price_breaks.size > 0 -%}
                              <volume-pricing class="parent-display">
                                <ul class="list-unstyled">
                                  <li>
                                    <span>{{ item.variant.quantity_rule.min }}+</span>
                                    {%- assign price = item.variant.price | money_with_currency -%}
                                    <span> {{ 'sections.quick_order_list.each' | t: money: price }}</span>
                                  </li>
                                  {%- for price_break in item.variant.quantity_price_breaks -%}
                                    <li>
                                      <span>
                                        {{- price_break.minimum_quantity -}}
                                        <span aria-hidden="true">+</span></span
                                      >
                                      {%- assign price = price_break.price | money_with_currency -%}
                                      <span> {{ 'sections.quick_order_list.each' | t: money: price }}</span>
                                    </li>
                                  {%- endfor -%}
                                </ul>
                              </volume-pricing>
                            {%- endif -%}
                          </div>
                        {%- endif -%}
                        <div class="cart-item__error" id="Line-item-error-{{ item.index | plus: 1 }}" role="alert">
                          <small class="cart-item__error-text"></small>
                          <svg
                            aria-hidden="true"
                            focusable="false"
                            class="icon icon-error"
                            viewBox="0 0 13 13"
                          >
                            <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"/>
                            <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
                            <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z" fill="white"/>
                            <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z" fill="white" stroke="#EB001B" stroke-width="0.7">
                          </svg>
                        </div>
                      </quantity-popover>
                    </td>

                    <td class="cart-item__totals right small-hide">
                      {%- render 'loading-spinner' -%}
                      <div class="cart-item__price-wrapper">
                        {%- if item.original_line_price != item.final_line_price -%}
                          <dl class="cart-item__discounted-prices">
                            <dt class="visually-hidden">
                              {{ 'products.product.price.regular_price' | t }}
                            </dt>
                            <dd>
                              <s class="cart-item__old-price price price--end">
                                {{ item.original_line_price | money }}
                              </s>
                            </dd>
                            <dt class="visually-hidden">
                              {{ 'products.product.price.sale_price' | t }}
                            </dt>
                            <dd class="price price--end">
                              {{ item.final_line_price | money }}
                            </dd>
                          </dl>
                        {%- else -%}
                          <span class="price price--end">
                            {{ item.original_line_price | money }}
                          </span>
                        {%- endif -%}

                        {%- if item.variant.available and item.unit_price_measurement -%}
                          <div class="unit-price caption">
                            <span class="visually-hidden">{{ 'products.product.price.unit_price' | t }}</span>
                            {{ item.unit_price | money }}
                            <span aria-hidden="true">/</span>
                            <span class="visually-hidden"
                              >&nbsp;{{ 'accessibility.unit_price_separator' | t }}&nbsp;</span
                            >
                            {%- if item.unit_price_measurement.reference_value != 1 -%}
                              {{- item.unit_price_measurement.reference_value -}}
                            {%- endif -%}
                            {{ item.unit_price_measurement.reference_unit }}
                          </div>
                        {%- endif -%}
                      </div>
                    </td>
                  </tr>
                {%- endfor -%}
              </tbody>
            </table>
          {%- endif -%}
        </div>
      </div>

      <p class="visually-hidden" id="cart-live-region-text" aria-live="polite" role="status"></p>
      <p
        class="visually-hidden"
        id="shopping-cart-line-item-status"
        aria-live="polite"
        aria-hidden="true"
        role="status"
      >
        {{ 'accessibility.loading' | t }}
      </p>
    </form>
  </div>
</cart-items>

<section class="breadcrumb__area include-bg pt-95 pb-50">
  <div class="container">
    <div class="row">
      <div class="col-xxl-12">
        <div class="breadcrumb__content p-relative z-index-1">
          <h3 class="breadcrumb__title">Shopping Cart</h3>
          <div class="breadcrumb__list">
            <span><a href="/">Home</a></span>
            <span>Shopping Cart</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="tp-cart-area pb-120">
  <div class="container">
    {% if cart.item_count > 0 %}
      <div class="row">
        <div class="col-xl-9 col-lg-8">
          <div class="tp-cart-list mb-25 mr-30">
            <table class="table">
              <thead>
                <tr>
                  <th colspan="2" class="tp-cart-header-product">Product</th>
                  <th class="tp-cart-header-price">Price</th>
                  <th class="tp-cart-header-quantity">Quantity</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                {% assign initial_subtotal = 0 %}
                {%- for item in cart.items -%}
                  {% assign item_total_price = item.quantity | times: item.price %}
                  {% assign initial_subtotal = initial_subtotal | plus: item_total_price %}
                  <tr>
                    <td class="tp-cart-img">
                      <a href="{{ item.url }}">
                        <img
                          src="{{ item.image | image_url: width: 300 }}"
                          alt="{{ item.image.alt | escape }}"
                          width="100%"
                          height="20px"
                        >
                      </a>
                    </td>
                    <td class="tp-cart-title">
                      <a href="{{ item.url }}">{{ item.product.title | escape }}</a>
                      {%- if item.product.has_only_default_variant == false -%}
                        {%- for option in item.options_with_values -%}
                          <div class="d-flex">
                            <dt>{{ option.name }}:</dt>
                            <dd>{{ option.value }}</dd>
                          </div>
                        {%- endfor -%}
                      {%- endif -%}
                    </td>
                    <td class="tp-cart-price">
                      <span>{{- item.original_price | money -}}</span>
                    </td>
                    <td class="tp-cart-quantity">
                      <div class="tp-product-quantity mt-10 mb-10">
                        <span class="tp-cart-minus">
                          <svg width="10" height="2" viewBox="0 0 10 2" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 1H9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </span>
                        <input
                          class="tp-cart-input"
                          type="text"
                          value="{{ item.quantity }}"
                          data-item-id="{{ item.id }}"
                        >
                        <span class="tp-cart-plus">
                          <svg
                            width="10"
                            height="10"
                            viewBox="0 0 10 10"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path d="M5 1V9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M1 5H9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </span>
                      </div>
                    </td>
                    <td class="tp-cart-action">
                      <button class="tp-cart-action-btn" onclick="removeItem('{{ item.id }}')">
                        <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path fill-rule="evenodd" clip-rule="evenodd" d="M9.53033 1.53033C9.82322 1.23744 9.82322 0.762563 9.53033 0.46967C9.23744 0.176777 8.76256 0.176777 8.46967 0.46967L5 3.93934L1.53033 0.46967C1.23744 0.176777 0.762563 0.176777 0.46967 0.46967C0.176777 0.762563 0.176777 1.23744 0.46967 1.53033L3.93934 5L0.46967 8.46967C0.176777 8.76256 0.176777 9.23744 0.46967 9.53033C0.762563 9.82322 1.23744 9.82322 1.53033 9.53033L5 6.06066L8.46967 9.53033C8.76256 9.82322 9.23744 9.82322 9.53033 9.53033C9.82322 9.23744 9.82322 8.76256 9.53033 8.46967L6.06066 5L9.53033 1.53033Z" fill="currentColor"/>
                        </svg>
                        <span>Remove</span>
                      </button>
                    </td>
                  </tr>
                {%- endfor -%}
              </tbody>
            </table>
          </div>
          <div class="tp-cart-bottom">
            <div class="row align-items-end">
              <div class="col-xl-6 col-md-8">
                <div class="tp-cart-coupon">
                  <div class="tp-cart-coupon-input-box">
                    <label>Coupon Code:</label>
                    <small id="discount-code-error"></small>
                    <div class="tp-cart-coupon-input d-flex align-items-center">
                      <input
                        id="discount-code-input"
                        autocomplete="on"
                        value=""
                        type="text"
                        placeholder="Enter Coupon Code"
                      >

                      <button id="apply-discount-btn">Apply</button>
                    </div>
                  </div>
                </div>
              </div>
              {% comment %}
                <div class="col-xl-6 col-md-4">
                  <div class="tp-cart-update text-md-end">
                    <button type="button" class="tp-cart-update-btn  me-5" >Update Cart</button>
                  </div>
                </div>
              {% endcomment %}
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-lg-4 col-md-6">
          <div class="tp-cart-checkout-wrapper">
            <div class="tp-cart-checkout-top d-flex align-items-center justify-content-between">
              <span class="tp-cart-checkout-top-title">Subtotal:</span>
              <span class="tp-cart-checkout-top-price">{{ initial_subtotal | money }}</span>
            </div>
            <div class="tp-cart-checkout-shipping">
              <h4 class="tp-cart-checkout-shipping-title">Shipping:</h4>

              {% comment %}
                <div class="tp-cart-checkout-shipping-option-wrapper">
                  <div class="tp-cart-checkout-shipping-option">
                    <input id="flat_rate" type="radio" name="shipping">
                    <label for="flat_rate">Flat rate: <span>$20.00</span></label>
                  </div>
                  <div class="tp-cart-checkout-shipping-option">
                    <input id="local_pickup" type="radio" name="shipping">
                    <label for="local_pickup">Local pickup: <span> $25.00</span></label>
                  </div>
                  <div class="tp-cart-checkout-shipping-option">
                    <input id="free_shipping" type="radio" name="shipping">
                    <label for="free_shipping">Free shipping</label>
                  </div>
                </div>
              {% endcomment %}
              <small class="">
                {%- if cart.taxes_included and shop.shipping_policy.body != blank -%}
                  {{ 'sections.cart.taxes_included_and_shipping_policy_html' | t: link: shop.shipping_policy.url }}
                {%- elsif cart.taxes_included -%}
                  {{ 'sections.cart.taxes_included_but_shipping_at_checkout' | t }}
                {%- elsif shop.shipping_policy.body != blank -%}
                  {{ 'sections.cart.taxes_and_shipping_policy_at_checkout_html' | t: link: shop.shipping_policy.url }}
                {%- else -%}
                  {{ 'sections.cart.taxes_and_shipping_at_checkout' | t }}
                {%- endif -%}
              </small>
            </div>
            <div class="tp-cart-checkout-shipping">
              <h4 class="tp-cart-checkout-shipping-title">Discount:</h4>
              <small class="">Coupon can be removed during checkout </small>
              {% comment %} <span class="cart__subtotal money"></span> {% endcomment %}
              <span id="applied-discount-code">
                <span class="applied-discount-code-wrapper d-inline-flex">
                  <span class="tag-icon">
                    <i class="fa-solid fa-tag"></i>
                  </span>

                  <span class="applied-discount-code-value">Coupon to be applied here</span>
                  <button id="clear-discount-btn" style="display:none;"><i class="fa-solid fa-xmark"></i></button>
                </span>
              </span>
            </div>

            <div class="tp-cart-checkout-total d-flex align-items-center justify-content-between">
              <span>Total:</span>
              <span class="final-total">{{ cart.total_price | money }}</span>
            </div>
            <div class="tp-cart-checkout-proceed">
              {% comment %} <a href="checkout.html" class="tp-cart-checkout-btn w-100">Proceed to Checkout</a> {% endcomment %}
              <button
                type="submit"
                id="checkout"
                class="tp-cart-checkout-btn w-100 cart__checkout-button button"
                name="checkout"
                {% if cart == empty %}
                  disabled
                {% endif %}
                form="cart"
              >
                Proceed to Checkout
              </button>
            </div>
            {%- if additional_checkout_buttons -%}
              <div class="cart__dynamic-checkout-buttons additional-checkout-buttons">
                {{ content_for_additional_checkout_buttons }}
              </div>
            {%- else -%}
              <p>Debug: No additional checkout buttons available.</p>
            {%- endif -%}
          </div>
        </div>
      </div>
    {% else %}
      <div class="empty_sec text-center">
        <h3 style="margin-bottom: 20px;">Your Cart is empty</h3>
        <a href="/" class="tp-btn">Go to Shop</a>
      </div>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "t:sections.main-cart-items.name",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ]
}
{% endschema %}

<script>
  function removeItem(itemId) {
    fetch('/cart/update.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Requested-With': 'XMLHttpRequest',
      },
      body: JSON.stringify({
        updates: {
          [itemId]: 0, // Set quantity to 0 to remove the item
        },
      }),
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error('Failed to update cart');
        }
        return response.json();
      })
      .then((data) => {
        console.log('Item removed:', data);
        window.location.reload(); // Reload the window after success
      })
      .catch((error) => console.error('Error:', error));
  }
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.tp-cart-minus').forEach(function (button) {
      button.addEventListener('click', function () {
        let input = this.nextElementSibling;
        let quantity = parseInt(input.value) - 1;
        if (quantity >= 0) {
          input.value = quantity;
          updateCart(input.dataset.itemId, quantity);
        }
      });
    });

    document.querySelectorAll('.tp-cart-plus').forEach(function (button) {
      button.addEventListener('click', function () {
        let input = this.previousElementSibling;
        let quantity = parseInt(input.value) + 1;
        input.value = quantity;
        updateCart(input.dataset.itemId, quantity);
      });
    });

    function updateCart(itemId, quantity) {
      fetch('/cart/update.js', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Accept: 'application/json',
        },
        body: JSON.stringify({
          updates: {
            [itemId]: quantity,
          },
        }),
      })
        .then((response) => response.json())
        .then((data) => {
          console.log('Cart updated', data);
          window.location.reload(); // Reload the window after success
        })
        .catch((error) => console.error('Error updating cart:', error));
    }
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function (event) {
    let clearBtn = document.querySelector('#clear-discount-btn');
    let applyBtn = document.querySelector('#apply-discount-btn');
    let discountCodeError = document.querySelector('#discount-code-error');
    let discountCodeWrapper = document.querySelector('#applied-discount-code .applied-discount-code-wrapper');
    let discountCodeValue = document.querySelector('#applied-discount-code .applied-discount-code-value');
    let discountCodeInput = document.querySelector('#discount-code-input');
    let totalCartSelector = document.querySelector('.cart__subtotal .money');
    let authorization_token;
    let subtotal = document.querySelector('.tp-cart-checkout-top-price');
    let final_total = document.querySelector('.final-total');

    let checkoutContainer = document.createElement('div');
    document.body.appendChild(checkoutContainer);

    // Check if the discount code was applied and set a flag in local storage
    let discountData = JSON.parse(localStorage.getItem('discountCode'));
    if (discountData && discountData.applied) {
      applyDiscount(discountData.code, true); // pass true to indicate initial application
    }

    if (applyBtn) {
      applyBtn.addEventListener('click', function (e) {
        e.preventDefault();
        applyDiscount(discountCodeInput.value);
      });
    }

    if (clearBtn) {
      clearBtn.addEventListener('click', function (e) {
        e.preventDefault();
        clearDiscount();
      });
    }

    // Function to check if discount session is available
    function isDiscountSessionAvailable() {
      // Implement your logic to check if a discount session exists
      // This might involve checking localStorage or some other state
      // For example, you could check if discountData is present in localStorage

      let discountData = localStorage.getItem('discountCode');
      return !!discountData; // Returns true if discountData is not null or undefined
    }

    function clearDiscount() {
      console.log('clearDiscount called');
      discountCodeValue.innerHTML = '';
      discountCodeError.innerHTML = '';
      clearLocalStorage();

      // Clear discount on the server
      fetch('/discounts/clear', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          discount_code: '',
        }),
      })
        .then(function (response) {
          console.log('Fetch response:', response);
          if (response.ok) {
            return response.json();
          } else {
            throw new Error('Failed to clear discount on server');
          }
        })
        .then(function (data) {
          // Successfully cleared on server, update the UI accordingly
          console.log('Discount cleared on server:', data);
          updateCartUIAfterClear();
        })
        .catch(function (error) {
          console.error('Fetch error:', error);
        });
    }

    // Modified clearLocalStorage function with check for discount session
    function clearLocalStorage() {
      console.log('clearLocalStorage called');

      // Check if discount session is available
      if (isDiscountSessionAvailable()) {
        // Hide discountCodeWrapper if it exists
        if (discountCodeWrapper) {
          discountCodeWrapper.style.display = 'none';
        }

        // Update totalCartSelector with stored discount data
        if (totalCartSelector) {
          let discountData = localStorage.getItem('discountCode');
          if (discountData) {
            let parsedData = JSON.parse(discountData);
            totalCartSelector.innerHTML = parsedData.totalCart;
          }
        }

        // Remove discountCode from localStorage
        localStorage.removeItem('discountCode');
      }
    }

    function applyDiscount(code, initial = false) {
      if (!initial && applyBtn) {
        applyBtn.innerHTML = "Applying <div class='loader'></div>";
        applyBtn.style.pointerEvents = 'none';
      }
      fetch('/payments/config', { method: 'GET' })
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          const checkout_json_url = '/wallets/checkouts/';
          authorization_token = btoa(data.paymentInstruments.accessToken);
          fetch('/cart.js', {})
            .then(function (res) {
              return res.json();
            })
            .then(function (data) {
              let body = {
                checkout: {
                  country: Shopify.country,
                  discount_code: code,
                  line_items: data.items,
                  presentment_currency: Shopify.currency.active,
                },
              };
              fetch(checkout_json_url, {
                headers: {
                  accept: '*/*',
                  'cache-control': 'no-cache',
                  authorization: 'Basic ' + authorization_token,
                  'content-type': 'application/json, text/javascript',
                  pragma: 'no-cache',
                  'sec-fetch-dest': 'empty',
                  'sec-fetch-mode': 'cors',
                  'sec-fetch-site': 'same-origin',
                },
                referrerPolicy: 'strict-origin-when-cross-origin',
                method: 'POST',
                mode: 'cors',
                credentials: 'include',
                body: JSON.stringify(body),
              })
                .then(function (response) {
                  return response.json();
                })
                .then(function (data) {
                  console.log(data.checkout);
                  if (data.checkout && data.checkout.applied_discounts.length > 0) {
                    let discountApplyUrl = '/discount/' + code + '?v=' + Date.now() + '&redirect=/checkout/';
                    fetch(discountApplyUrl, {}).then(function (response) {
                      return response.text();
                    });
                    if (discountCodeWrapper) discountCodeWrapper.style.display = 'inline';
                    if (discountCodeError) discountCodeError.innerHTML = '';
                    if (discountCodeValue)
                      discountCodeValue.innerHTML =
                        '<b>' +
                        data.checkout.applied_discounts[0].title +
                        '</b>' +
                        ' applied -$' +
                        data.checkout.applied_discounts[0].amount +
                        '';

                    let base_subtotal =
                      parseFloat(data.checkout.total_price) + parseFloat(data.checkout.applied_discounts[0].amount);
                    subtotal.innerHTML = '$' + base_subtotal.toFixed(2);

                    final_total.innerHTML = '$' + data.checkout.total_price;

                    let localStorageValue = {
                      code: code.trim(),
                      totalCart: data.checkout.total_line_items_price,
                      applied: true, // mark the discount code as applied
                    };
                    localStorage.setItem('discountCode', JSON.stringify(localStorageValue));
                    if (totalCartSelector)
                      totalCartSelector.innerHTML =
                        '<s>' + data.checkout.total_line_items_price + '</s>' + data.checkout.total_price;
                  } else {
                    if (discountCodeValue) discountCodeValue.innerHTML = '';
                    clearLocalStorage();
                    if (discountCodeError) discountCodeError.innerHTML = 'Please Enter Valid Coupon Code.';
                  }
                })
                .finally(function (params) {
                  if (applyBtn) {
                    applyBtn.innerHTML = 'Apply';
                    applyBtn.style.pointerEvents = 'all';
                    clearBtn.style.display = 'block';
                  }
                });
            });
        });
    }
  });
</script>
